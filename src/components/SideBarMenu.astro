---
// Active menu item is determined dynamically via URL in the script below
import { getBaseUrl } from "../lib/getBaseUrl";
const base = getBaseUrl();
---

<ul class="menu grow shrink menu-md overflow-y-auto" data-base={base}>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="home" href={base}>Home</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="resume" href={`${base}resume/`}>Resume</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="blog" href={`${base}blog/`}>Blog</a></li>
    <li><a class="py-3 text-base hover:bg-accent hover:text-accent-content transition-colors" id="pottery" href={`${base}pottery/`}>Pottery</a></li>
</ul>

<script>
function updateActiveMenuItem() {
  const activeClass = 'bg-base-300';
  const menu = document.querySelector('.menu');
  const base = menu?.getAttribute('data-base') || '/';

  // Remove active class from all menu items
  document.querySelectorAll('.menu a').forEach(el => {
    el.classList.remove(activeClass);
  });

  // Always determine active item from current URL
  const path = window.location.pathname;
  let activeId = 'home';

  // Defensive: ensure base is valid string
  if (typeof base !== 'string' || base.length === 0) {
    // Fallback to simple matching if base is invalid
    if (path.includes('/resume')) activeId = 'resume';
    else if (path.includes('/blog')) activeId = 'blog';
    else if (path.includes('/pottery')) activeId = 'pottery';
  } else {
    // Normal path matching with base
    const normalizedBase = base.endsWith('/') ? base : base + '/';
    const homeMatch = path === base || path === normalizedBase || path === base + 'index.html' || path === base.slice(0, -1);
    const resumeMatch = path.startsWith(normalizedBase + 'resume');
    const blogMatch = path.startsWith(normalizedBase + 'blog');
    const potteryMatch = path.startsWith(normalizedBase + 'pottery');

    if (homeMatch && !resumeMatch && !blogMatch && !potteryMatch) activeId = 'home';
    else if (resumeMatch) activeId = 'resume';
    else if (blogMatch) activeId = 'blog';
    else if (potteryMatch) activeId = 'pottery';
  }

  const activeItemElem = document.getElementById(activeId);
  if (activeItemElem) activeItemElem.classList.add(activeClass);
}

// Add listener only once - astro:page-load fires on initial load AND view transitions
if (!window.__menuListenerAttached) {
  window.__menuListenerAttached = true;
  document.addEventListener('astro:page-load', updateActiveMenuItem);
}
</script>
